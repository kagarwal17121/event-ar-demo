<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event AR — Catalog Check</title>
  <style>
    :root { --bg:#0b0c10; --card:#12141a; --text:#e9ecf1; --muted:#9aa4b2; --ok:#2ecc71; --err:#ff5d5d; }
    html,body{margin:0;background:var(--bg);color:var(--text);font:15px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #status{position:sticky;top:0;padding:.6rem .8rem;background:#000a;border-bottom:1px solid #222;color:#ddd;font-size:13px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    main{max-width:920px;margin:16px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{background:var(--card);border:1px solid #1e2230;border-radius:12px;overflow:hidden}
    .thumb{width:100%;aspect-ratio:16/10;object-fit:cover;background:#0f1115}
    .pad{padding:10px}
    .name{font-weight:600}
    .muted{color:var(--muted);font-size:12px}
    a.btn{display:inline-block;margin-top:8px;padding:8px 10px;border-radius:10px;background:#2f6dff;color:#fff;text-decoration:none}
    code{background:#0e1117;border:1px solid #1a2030;border-radius:6px;padding:1px 6px}
  </style>
</head>
<body>
  <div id="status">boot…</div>
  <main>
    <h1>Catalog sanity check</h1>
    <p>This page only fetches <code>./models/models.json</code> and renders cards. If this works, your paths & JSON are correct.</p>
    <div id="grid" class="grid"></div>

    <h3>Tips if it fails</h3>
    <ul>
      <li>Paths on GitHub Pages are <b>case-sensitive</b>. Folder must be <code>models/</code> and file exactly <code>models.json</code>.</li>
      <li>Use a <b>relative</b> fetch: <code>./models/models.json</code> (do <em>not</em> use <code>/models/models.json</code>).</li>
      <li>Ensure there’s no hidden extension (e.g., <code>models.json.txt</code>).</li>
      <li>Validate JSON is an array (or has <code>{"models":[...]}</code>) and contains <code>name</code>, <code>url</code>, and optional <code>thumbnail</code>.</li>
    </ul>
  </main>

  <script>
    const S = document.getElementById('status');
    const G = document.getElementById('grid');

    function setStatus(msg, cls){ S.className=cls||''; S.textContent = msg; }

    async function loadCatalog() {
      try {
        setStatus('Fetching ./models/models.json …');
        // Always use relative path so it works under /event-ar-demo/
        const res = await fetch('./models/models.json', { cache: 'no-store' });
        if (!res.ok) {
          // Give exact HTTP status so we know why
          throw new Error(`HTTP ${res.status} (${res.statusText}) for ./models/models.json`);
        }
        const data = await res.json();
        const list = Array.isArray(data) ? data : (data.models || []);
        if (!Array.isArray(list) || list.length === 0) {
          throw new Error('JSON parsed but no items found (expects array or {"models":[...]})');
        }
        // Render cards
        G.innerHTML = '';
        for (const item of list) {
          const name = item.name || '(unnamed)';
          const url  = item.url || item.file || item.src || '';
          const thumb= item.thumbnail || '';
          const el = document.createElement('div');
          el.className = 'card';
          el.innerHTML = `
            ${thumb ? `<img class="thumb" src="${thumb}" alt="${name}">` : `<div class="thumb"></div>`}
            <div class="pad">
              <div class="name">${name}</div>
              <div class="muted">${url ? url : '(no url in JSON item)'}</div>
              <a class="btn" href="${url || '#'}" target="_blank" rel="noopener">open GLB</a>
              <a class="btn" href="./index-multi.html" style="background:#454a57">open AR</a>
            </div>
          `;
          G.appendChild(el);
        }
        setStatus(`OK — Loaded ${list.length} items from ./models/models.json`, 'ok');
      } catch (err) {
        console.error(err);
        setStatus(`Failed to load catalog: ${err.message}`, 'err');
      }
    }

    // Helpful: show unhandled errors so you're never stuck on "boot…"
    window.addEventListener('error', (e)=> setStatus(`JS error: ${e.message}`, 'err'));
    window.addEventListener('unhandledrejection', (e)=> setStatus(`Promise error: ${e.reason?.message || e.reason}`, 'err'));

    loadCatalog();
  </script>
</body>
</html>
